<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="style.css">
<script src="classes.js"></script>
</head>
<body onload="startAnimation()">
<p>Client - Server info here.</p>
<p>Choose animation parameters here.</p>
Some parameter :
<select>
  <option value=128>128 Bytes</option>
  <option value=256>256 Bytes</option>
  <option value=512>512 Bytes</option>
  <option value=1028>1028 Bytes</option>
</select>
Another parameter :
<select>
  <option value=128>128 Bytes</option>
  <option value=256>256 Bytes</option>
  <option value=512>512 Bytes</option>
  <option value=1028>1028 Bytes</option>
</select>
</br>
<button onclick="toggleRunning()">Start/Pause</button>
<p></p>
<script>

var travellingPackets = [];
var server;
var clients = [];
var isAnimationRunning = false;
var timerTick = 0;

function toggleRunning(){
    if(isAnimationRunning)
        isAnimationRunning = false;
    else 
        isAnimationRunning = true;
}

function startAnimation() {
    clients.push(new MyClient("red", 10, 120, "Client-1"));
    clients.push(new MyClient("green", 200, 250, "Client-2"));
    server = new MyServer(200, 90, "Server");
    animationCanvas.initializeAndStart();
}

var animationCanvas = {
    width : 500,
    height : 300,
    initializeAndStart : function() {
        var canvas = document.createElement("canvas");
        canvas.width = this.width;
        canvas.height = this.height;
        this.context = canvas.getContext("2d");
        document.body.appendChild(canvas);
        this.interval = setInterval(updateAnimation, 20);
    }
}

function updateAnimation() {
    animationCanvas.context.clearRect(0, 0, animationCanvas.width, animationCanvas.height);

    if(isAnimationRunning){
        timerTick += 1;

        if(Math.random() > 0.95){
            for (j = 0; j < clients.length; j++){
                travellingPackets.push(clients[j].sendPacket(210, 100));
            }
            travellingPackets.push(server.sendPacket(15, 130));
        }

        for (i = 0; i < travellingPackets.length; i++) {
            for (j = 0; j < clients.length; j++) {
                if (clients[j].detectCollision(travellingPackets[i])) {
                    travellingPackets.splice(i,1);
                }
            }
            if (server.detectCollision(travellingPackets[i])) {
                travellingPackets.splice(i,1);
            }
        }

        for (i = 0; i < travellingPackets.length; i++)
            travellingPackets[i].updatePosition();
    }

    for (i = 0; i < travellingPackets.length; i++)
        travellingPackets[i].draw(animationCanvas.context);
    
    for (j = 0; j < clients.length; j++)
        clients[j].draw(animationCanvas.context);

    server.draw(animationCanvas.context);
}
</script>
</body>
</html>